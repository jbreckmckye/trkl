(function(g,b){"function"===typeof define&&define.amd?define("trkl",[],b):g.trkl=b()})(this,function(){function g(l){function h(a){-1===e.indexOf(a)&&e.push(a)}function k(a){var c=f;f=a;c!==a&&e.forEach(function(a){a(f,c)})}var f=l,e=[],d=function(a){if(0<arguments.length)k(a);else{var c=b[b.length-1];c&&h(c.subscriber);return f}};d.subscribe=h;d.unsubscribe=function(a){var c=e;a=c.indexOf(a);-1!==a&&c.splice(a,1)};d.map=function(a){return g.computed(function(){return a(d())})};d.history=function(a){var c=
    g([f]);h(function(d){var b;b=c().slice(0);b.push(d);a&&(b=b.slice(-a));c(b)});return c};return d}var b=[];g.computed=function(l){function h(){if(-1!==b.indexOf(f))throw Error("Circular computation detected");b.push(f);var e,d;try{d=l()}catch(a){e=a}b.pop();if(e)throw e;k(d)}var k=g(),f={subscriber:h};h();return k};return g});
(function(a,d){"function"===typeof define&&define.amd?define("trkl",[],d):a.trkl=d()})(this,function(){function a(h){function f(b){var c=e;e=b;c!==b&&g.forEach(function(b){b(e,c)})}var e=h,g=[],c=function(b){if(0<arguments.length)f(b);else{var a=d[d.length-1];a&&c.subscribe(a.subscriber);return e}};c.subscribe=function(b){-1===g.indexOf(b)&&g.push(b)};c.unsubscribe=function(b){var c=g;(b=c.indexOf(b))&&c.splice(b,1)};c.map=function(b){return a.computed(function(){return b(c())})};c.scan=function(b,
e){var d=a();a.computed(function(){var a=b(e,c());d(a)});return d};return c}var d=[];a.computed=function(h){function f(){if(-1!==d.indexOf(g))throw Error("Circular computation detected");d.push(g);var c,b;try{b=h()}catch(a){c=a}d.pop();if(c)throw c;e(b)}var e=a(),g={subscriber:f};f();return e};a.asyncComputed=function(d){d=a.computed(d);var f=a();d.subscribe(function(a){a.then(f)});return f};return a});
function(){function l(b){return new h(b)}function h(b,f){function d(c){var a=e;e=c;a!==c&&g.forEach(function(c){c(e,a)})}var e=b,g=[],a=function(c){if(0<arguments.length)d(c);else{var b=k[k.length-1];if(b)b.onStreamRead(a);return e}};a.subscribe=function(c){-1===g.indexOf(c)&&g.push(c)};a.unsubscribe=function(c){var a=g;(c=a.indexOf(c))&&a.splice(c,1)};a.map=function(c){var b=new h;a.subscribe(function(a){b(c(a))});return b};return a}var k=[];l.computed=function(b){function f(){if(-1!==k.indexOf(g))throw Error("Circular computation detected");
k.push(g);var a,c;try{c=b()}catch(d){a=d}k.pop();if(a)throw a;e(c)}var d=[],e=new h,g={onStreamRead:function(a){-1===d.indexOf(a)&&(a.subscribe(f),d.push(a))}};f();return e};l.merge=function(b){b=Array.prototype.slice.call(arguments,0);var f=new h;b.forEach(function(b){b.subscribe(f)});return f};l.reduce=function(b,f,d){var e=new h;d=d||b();b.subscribe(function(b){e(f(d,b))});return e};return l})();

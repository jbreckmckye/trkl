(function(){function l(f){return new h(f)}function h(f,g){function d(b){var a=e;e=b;a!==b&&c.forEach(function(b){b(e,a)})}var e=f,c=[],a=function(b){if(0<arguments.length)d(b);else{var c=k[k.length-1];if(c)c.onStreamRead(a);return e}};a.subscribe=function(b){-1===c.indexOf(b)&&c.push(b)};a.unsubscribe=function(b){var a=c;(b=a.indexOf(b))&&a.splice(b,1)};a.map=function(b){var c=new h;a.subscribe(function(a){c(b(a))});return c};return a}var k=[];l.computed=function(f){function g(){if(-1!==k.indexOf(c))throw Error("Circular computation detected");
k.push(c);var a,b;try{b=f()}catch(d){a=d}k.pop();if(a)throw a;e(b)}var d=[],e=new h,c={onStreamRead:function(a){-1===d.indexOf(a)&&(a.subscribe(g),d.push(a))}};g();return e};l.filter=function(f,g){var d=new h;f.subscribe(function(e,c){g(e,c)&&d(e)});return d};l.reduce=function(f,g,d){var e=new h;d=d||f();f.subscribe(function(c){e(g(d,c))});return e};return l})();
